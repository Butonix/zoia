"use strict";!function(t,e,s,i){var a={load:{url:"#",method:"POST"},save:{url:"#",method:"POST"},captcha:"/api/captcha",items:[],edit:!1,html:{helpText:'<div class="za-text-meta">{text}</div>',text:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><input class="za-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>',select:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><select class="za-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-flex"><div class="{prefix}-field-wrap"><input class="za-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="za-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',captcha:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-grid za-grid-small"><div><input class="za-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="za-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="za-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>'},template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:"Should not be empty",tooShort:"Too short",tooLong:"Too long",invalidFormat:"Doesn't match required format",passwordsNotMatch:"Passwords do not match"},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(){},onSaveSuccess:function(){},onSaveError:function(){},onLoadStart:function(){},onLoadSuccess:function(){},onLoadError:function(){}},formDangerClass:"za-form-danger"},n=function(e,s){this.element=e,this.settings=t.extend({},a,s),this._defaults=a,this._name="zoiaFormBuilder",this._prefix=this.element.id,this._formTypes=["text","email","password","select","passwordConfirm","captcha"],this._saving=!1,this.init()};t.extend(n.prototype,{init:function(){var e="",s="";for(var i in this.settings.items){var a=this.settings.items[i];switch(a.type){case"text":case"email":case"password":e+=this._template(this.settings.html.text,{prefix:this._prefix,name:i,label:a.label,css:a.css?" "+a.css:"",autofocus:a.autofocus?"autofocus":"",helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):"",type:a.type});break;case"select":var n="";for(var o in a.values)n+='<option value="'+o+'">'+a.values[o]+"</option>";e+=this._template(this.settings.html.select,{prefix:this._prefix,name:i,label:a.label,css:a.css?" "+a.css:"",autofocus:a.autofocus?"autofocus":"",helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):"",type:a.type,values:n});break;case"passwordConfirm":e+=this._template(this.settings.html.passwordConfirm,{prefix:this._prefix,name:i,label:a.label,css:a.css?" "+a.css:"",autofocus:a.autofocus?"autofocus":"",helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):"",type:"password"});break;case"captcha":e+=this._template(this.settings.html.captcha,{prefix:this._prefix,name:i,css:a.css?" "+a.css:"",label:a.label,helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):"",autofocus:a.autofocus?"autofocus":""});break;case"buttons":for(var r="",l=0;l<a.buttons.length;l++){var f=a.buttons[l];r+=this._template(this.settings.html.button,{css:f.css?" "+f.css:"",prefix:this._prefix,name:f.name||"button"+l,type:f.type||"button",label:f.label||""})+"&nbsp;"}s+=this._template(this.settings.html.buttonsWrap,{prefix:this._prefix,css:a.css?" "+a.css:"",buttons:r,html:a.html?" "+a.html:""})}}t(this.element).html(this._template(this.settings.template.fields,{fields:e})+this._template(this.settings.template.buttons,{buttons:s})),!!this.settings.events.onInit&&this.settings.events.onInit();var c=this;t(this.element).submit(function(t){t.preventDefault(),c._submit()}),this._captchaInit()},setEditMode:function(t){this.settings.edit=t},clearErrors:function(){t("."+this._prefix+"-form-field").removeClass(this.settings.formDangerClass),t("."+this._prefix+"-error-text").hide()},resetForm:function(){this.clearErrors(),t("."+this._prefix+"-form-field").val(""),t("select."+this._prefix+"-form-field").prop("selectedIndex",0);for(var e in this.settings.items){var s=this.settings.items[e];s.default&&t("#"+this._prefix+"_"+e).val(s.default)}},loadData:function(e){!!this.settings.events.onLoadStart&&this.settings.events.onLoadStart(),this.resetForm();var s=this;t.ajax({type:this.settings.load.method,url:this.settings.load.url,data:e,cache:!1}).done(function(e){e&&1==e.status?(jQuery.each(e.item,function(e,i){t("#"+s._prefix+"_"+e).val(i)}),!!s.settings.events.onLoadSuccess&&s.settings.events.onLoadSuccess(e)):!!s.settings.events.onLoadError&&s.settings.events.onLoadError(e)}).fail(function(t,e){!!s.settings.events.onLoadError&&s.settings.events.onLoadError()})},captchaRefresh:function(){t("."+this._prefix+"-captcha-img").show(),t("."+this._prefix+"-captcha-img").attr("src",this.settings.captcha+"?"+(new Date).getTime()),t("."+this._prefix+"-captcha-field").val("")},_captchaInit:function(){this.captchaRefresh();var e=this;t("img."+this._prefix+"-captcha-img").click(function(){e.captchaRefresh()})},_template:function(t,e){for(var s in e)t=t.replace(new RegExp("{"+s+"}","g"),e[s]);return t},_submit:function(){if(!this._saving){!!this.settings.events.onSaveSubmit&&this.settings.events.onSaveSubmit(),this.clearErrors();var e={},s={},i=this;for(var a in this.settings.items){var n=this.settings.items[a];if(-1!=this._formTypes.indexOf(n.type)){var o=t("#"+this._prefix+"_"+a).val();if(n.validation){if(!n.validation.mandatoryEdit&&!o&&this.settings.edit||!n.validation.mandatoryCreate&&!o&&!this.settings.edit)continue;if(n.validation.mandatoryCreate&&!o&&!this.settings.edit){e[a]=this.settings.lang.mandatoryMissing;continue}if(n.validation.mandatoryEdit&&!o&&this.settings.edit){e[a]=this.settings.lang.mandatoryMissing;continue}if(n.validation.process&&"function"==typeof n.validation.process&&(o=n.validation.process(o)),"passwordConfirm"==n.type&&t("#"+this._prefix+"_"+a+"Confirm").val()!=o){e[a]=this.settings.lang.passwordsNotMatch;continue}if(n.validation.length){if(n.validation.length.min&&o.length<n.validation.length.min){e[a]=this.settings.lang.tooShort;continue}if(n.validation.length.max&&o.length>n.validation.length.max){e[a]=this.settings.lang.tooLong;continue}}if(n.validation.regexp&&!o.match(n.validation.regexp)){e[a]=this.settings.lang.invalidFormat;continue}s[a]=o}}}if(Object.keys(e).length>0){var r=!1;for(var l in e)t("#"+this._prefix+"_"+l).addClass(this.settings.formDangerClass),t("#"+this._prefix+"_"+l+"_error_text > span").html(e[l]),t("#"+this._prefix+"_"+l+"_error_text").show(),r||(t("#"+this._prefix+"_"+l).focus(),r=!0),"passwordConfirm"==this.settings.items[l].type&&t("#"+this._prefix+"_"+l+"Confirm").addClass(this.settings.formDangerClass)}else this.settings.events.onSaveValidate&&(s=this.settings.events.onSaveValidate(s)||s),i._saving=!0,t.ajax({type:this.settings.save.method,url:this.settings.save.url,data:s,cache:!1}).done(function(e){if(i._saving=!1,e&&1==e.status)!!i.settings.events.onSaveSuccess&&i.settings.events.onSaveSuccess(e);else{if(e.fields)for(var s in e.fields){var a=!1;t("#"+i._prefix+"_"+e.fields[s]).addClass(i.settings.formDangerClass),a||(t("#"+i._prefix+"_"+e.fields[s]).focus(),a=!0)}i.captchaRefresh(),!!i.settings.events.onSaveError&&i.settings.events.onSaveError(e)}}).fail(function(t,e){i._saving=!1,i.captchaRefresh(),i.settings.events.onSaveError?i.settings.events.onSaveError():fals})}}}),t.fn.zoiaFormBuilder=function(e){var s=void 0;return this.each(function(){(s=t.data(this,"plugin_zoiaFormBuilder"))||(s=new n(this,e),t.data(this,"plugin_zoiaFormBuilder",s))}),s}}(jQuery,window,document),$(document).ready(function(){$("#zoiaResetConfirm").zoiaFormBuilder({save:{url:"/api/auth/reset/confirm",method:"POST"},template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:lang["Should not be empty"],tooShort:lang["Too short"],tooLong:lang["Too long"],invalidFormat:lang["Doesn't match required format"],passwordsNotMatch:lang["Passwords do not match"]},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(t){return $("#zoiaResetConfirmSpinner").show(),$("#zoiaResetConfirm_btnSave").toggleClass("za-button-primary").toggleClass("za-button-default"),t.username=usernameConfirm,t.code=codeConfirm,t},onSaveSuccess:function(){$("#zoiaResetConfirm").hide(),$("#resetConfirmSuccessful").show(),$("html, body").animate({scrollTop:$("#zoiaResetConfirm").offset().top-20},"fast")},onSaveError:function(t){$("#zoiaResetConfirmSpinner").hide(),$("#zoiaResetConfirm_btnSave").toggleClass("za-button-primary").toggleClass("za-button-default"),t=t||{},$("#zoiaResetConfirm_password").focus(),$zUI.notification(lang["Error while setting new password"],{status:"danger"})}},items:{password:{autofocus:!0,type:"passwordConfirm",label:lang.Password,helpText:lang["Minimal length: 5 characters, type twice to verify"],validation:{mandatoryCreate:!0,length:{min:5,max:50},process:function(t){return t.trim()}}},buttons:{type:"buttons",css:"za-margin-top",buttons:[{name:"btnSave",label:'<div za-spinner class="za-margin-right" id="zoiaResetConfirmSpinner" style="display:none"></div>'+lang.Set,css:"za-button-primary",type:"submit"}]}}})});