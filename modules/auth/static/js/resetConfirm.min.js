"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){var e={load:{url:"#",method:"POST"},save:{url:"#",method:"POST"},captcha:"/api/captcha",items:[],edit:!1,validation:!0,html:{helpText:'<div class="uk-text-meta">{text}</div>',text:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><input class="uk-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',select:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><select{multiple} class="uk-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-flex"><div class="{prefix}-field-wrap"><input class="uk-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="uk-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',captcha:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-grid uk-grid-small"><div><input class="uk-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="uk-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="uk-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}_btn">{label}:{bullet}</label><div class="uk-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="uk-button uk-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}</div>',textarea:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><textarea class="uk-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',checkboxlistItem:'<li><label><input class="uk-checkbox {prefix}-{name}-cbx" type="checkbox" data="{title}">&nbsp;&nbsp;{title}</label></li>',checkboxlist:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-panel uk-panel-scrollable{css}" id="{prefix}_{name}_wrap"><ul class="uk-list">{items}</ul></div>{helpText}</div>',valueslistItem:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right"><input placeholder="{langParameter}" type="text" class="uk-input formBuilder-valueslist-par" value="{key}"></div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div><div style="padding-top:3px"><button class="uk-icon-button uk-button-danger formBuilder-valueslist-btnDel" uk-icon="icon:minus"></button></div></div>',valueslist:'<div class="uk-flex uk-flex-column"><div class="uk-margin-bottom"><label class="uk-form-label">{label}:{bullet}</label></div><div><button type="button" class="uk-icon-button uk-button-primary formBuilder-valueslist-btnAdd" id="{prefix}_{name}_btnAdd" uk-icon="icon:plus" data-prefix="{prefix}" data-name="{name}"></button></div><div id="{prefix}_{name}_wrap" class="uk-margin-bottom formBuilder-valueslist-wrap">{items}</div></div>',bullet:'&nbsp;<span style="color:red;font-size:120%">&#8226;</span>'},template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:"Should not be empty",tooShort:"Too short",tooLong:"Too long",invalidFormat:"Doesn't match required format",passwordsNotMatch:"Passwords do not match",parameter:"Parameter",value:"Value"},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(){},onSaveSuccess:function(){},onSaveError:function(){},onLoadStart:function(){},onLoadSuccess:function(){},onLoadError:function(){}},formDangerClass:"uk-form-danger"},s=function(s,i){this.element=s,this.settings=t.extend({},e,i),this._defaults=e,this._name="zoiaFormBuilder",this._prefix=this.element.id,this._formTypes=["text","email","password","select","passwordConfirm","captcha","launcher","textarea","checkboxlist","valueslist"],this._saving=!1,this.init()};t.extend(s.prototype,{init:function(){var e="",s="";for(var i in this.settings.items){var a=this.settings.items[i],l="";switch((a.validation&&!this.settings.edit&&a.validation.mandatoryCreate||a.validation&&this.settings.edit&&a.validation.mandatoryEdit)&&(l=this.settings.html.bullet),a.type){case"text":case"email":case"password":e+=this._template(this.settings.html.text,{prefix:this._prefix,name:i,label:a.label,bullet:l,css:a.css?" "+a.css:"",autofocus:a.autofocus?"autofocus":"",helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):"",type:a.type});break;case"launcher":e+=this._template(this.settings.html.launcher,{prefix:this._prefix,name:i,label:a.label,bullet:l,labelBtn:a.labelBtn,data:a.data,value:a.value,css:a.css?" "+a.css:"",helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):""});break;case"valueslist":var r="";for(var n in a.values)r+=this._template(this.settings.html.valueslistItem,{prefix:this._prefix,name:i,key:n,value:a.values[n],langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e+=this._template(this.settings.html.valueslist,{prefix:this._prefix,name:i,label:a.label,bullet:l,items:r});break;case"select":var o="";for(var p in a.values)o+='<option value="'+p+'">'+a.values[p]+"</option>";e+=this._template(this.settings.html.select,{prefix:this._prefix,name:i,label:a.label,bullet:l,css:a.css?" "+a.css:"",multiple:a.multiple?" multiple":"",autofocus:a.autofocus?"autofocus":"",helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):"",type:a.type,values:o});break;case"checkboxlist":var u="";for(var f in a.values)u+=this._template(this.settings.html.checkboxlistItem,{prefix:this._prefix,name:i,title:a.values[f]});e+=this._template(this.settings.html.checkboxlist,{prefix:this._prefix,name:i,label:a.label,bullet:l,css:a.css?" "+a.css:"",multiple:a.multiple?" multiple":"",helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):"",items:u});break;case"passwordConfirm":e+=this._template(this.settings.html.passwordConfirm,{prefix:this._prefix,name:i,label:a.label,bullet:l,css:a.css?" "+a.css:"",autofocus:a.autofocus?"autofocus":"",helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):"",type:"password"});break;case"captcha":e+=this._template(this.settings.html.captcha,{prefix:this._prefix,name:i,css:a.css?" "+a.css:"",label:a.label,bullet:l,helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):"",autofocus:a.autofocus?"autofocus":""});break;case"textarea":e+=this._template(this.settings.html.textarea,{prefix:this._prefix,name:i,label:a.label,bullet:l,css:a.css?" "+a.css:"",autofocus:a.autofocus?"autofocus":"",helpText:a.helpText?this._template(this.settings.html.helpText,{text:a.helpText,prefix:this._prefix}):""});break;case"buttons":for(var c="",d=0;d<a.buttons.length;d++){var h=a.buttons[d];c+=this._template(this.settings.html.button,{css:h.css?" "+h.css:"",prefix:this._prefix,name:h.name||"button"+d,type:h.type||"button",label:h.label||""})+"&nbsp;"}s+=this._template(this.settings.html.buttonsWrap,{prefix:this._prefix,css:a.css?" "+a.css:"",buttons:c,html:a.html?" "+a.html:""})}}t(this.element).html(this._template(this.settings.template.fields,{fields:e})+this._template(this.settings.template.buttons,{buttons:s})),t(".formBuilder-valueslist-btnAdd").unbind(),t(".formBuilder-valueslist-btnAdd").click(function(e){m._valueslistAddFunc(t(this).attr("data-prefix"),t(this).attr("data-name"),"","")}),t(".formBuilder-valueslist-btnDel").unbind(),t(".formBuilder-valueslist-btnDel").click(function(e){e.stopPropagation(),t(this).parent().parent().remove()}),this.settings.events.onInit&&this.settings.events.onInit();var m=this;t(this.element).submit(function(t){t.preventDefault(),m._submit()}),this._captchaInit()},_valueslistAddFunc:function(e,s,i,a,l){var r=this._template(this.settings.html.valueslistItem,{prefix:e,name:s,key:i,value:a,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t("#"+e+"_"+s+"_wrap").append(r),l||t("."+e+"-"+s+"-item").last().find("div>input:first").focus(),t(".formBuilder-valueslist-btnDel").unbind(),t(".formBuilder-valueslist-btnDel").click(function(e){e.stopPropagation(),t(this).parent().parent().remove()})},setValidation:function(t){this.validation=t},setEditMode:function(t){this.settings.edit=t},clearErrors:function(){t("."+this._prefix+"-form-field").removeClass(this.settings.formDangerClass),t("."+this._prefix+"-error-text").hide()},resetForm:function(){this.clearErrors();t("."+this._prefix+"-form-field").not(".zoiaFormBuilder-no-reset").val(""),t("select."+this._prefix+"-form-field").prop("selectedIndex",0),t(".formBuilder-valueslist-wrap").html("");for(var e in this.settings.items){var s=this.settings.items[e];s.default&&t("#"+this._prefix+"_"+e).val(s.default),"launcher"===s.type&&(t("#"+this._prefix+"_"+e+"_val").html(s.value),t("#"+this._prefix+"_"+e+"_val").attr("data",s.data)),"checkboxlist"===s.type&&t("."+this._prefix+"-"+e+"-cbx").prop("checked",!1)}},serialize:function(){var e=this,s={};for(var i in this.settings.items){var a=this.settings.items[i];-1!==this._formTypes.indexOf(a.type)&&function(){switch(a.type){case"launcher":s[i]={type:a.type,value:t("#"+e._prefix+"_"+i+"_val").html(),id:t("#"+e._prefix+"_"+i+"_val").attr("data")};break;case"checkboxlist":var l=t("."+e._prefix+"-"+i+"-cbx:checked").map(function(){return t(this).attr("data")}).get();s[i]={type:a.type,value:l.join(",")};break;case"valueslist":var r=[];t("."+e._prefix+"-"+i+"-item").each(function(){r.push({p:String(t(this).find("*>.formBuilder-valueslist-par").val()),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),s[i]={type:a.type,value:r};break;default:s[i]={type:a.type,value:t("#"+e._prefix+"_"+i).val()}}}()}return s},deserialize:function(e){if(e&&"object"===(void 0===e?"undefined":_typeof(e)))for(var s in this.settings.items)switch(e[s]||(e[s]={id:"",value:""}),e[s].type){case"launcher":t("#"+this._prefix+"_"+s+"_val").html(e[s].value),t("#"+this._prefix+"_"+s+"_val").attr("data",e[s].id);break;case"checkboxlist":var i=e[s].value.split(",");for(var a in i)t('.editForm-groups-cbx[data="'+i[a]+'"]').prop("checked",!0);break;case"valueslist":var l=[];for(var r in e[s].value)l.push(e[s].value[r].p),l.push(e[s].value[r].v);for(t("#"+this._prefix+"_"+s+"_wrap").html("");l.length>0;){var n=l.shift(),o=l.shift();this._valueslistAddFunc(this._prefix,s,n,o,!0)}break;default:t("#"+this._prefix+"_"+s).val(e[s].value||"")}},loadData:function(e){this.settings.events.onLoadStart&&this.settings.events.onLoadStart(),this.resetForm();var s=this;t.ajax({type:this.settings.load.method,url:this.settings.load.url,data:e,cache:!1}).done(function(e){e&&1===e.status?(jQuery.each(e.item,function(e,i){if(t("#"+s._prefix+"_"+e).val(i),s.settings.items[e]&&"checkboxlist"===s.settings.items[e].type&&i){var a=i.split(",");for(var l in a)t('.editForm-groups-cbx[data="'+a[l]+'"]').prop("checked",!0)}if(s.settings.items[e]&&"valueslist"===s.settings.items[e].type&&i){var r=[];for(var o in i)r.push(o),r.push(json[n].values[o]);t("#"+s._prefix+"_"+e+"_wrap").html("");for(var p in json[n].values)s._valueslistAddFunc(s._prefix,e,r.shift(),r.shift())}}),s.settings.events.onLoadSuccess&&s.settings.events.onLoadSuccess(e)):s.settings.events.onLoadError&&s.settings.events.onLoadError(e)}).fail(function(t,e){s.settings.events.onLoadError&&s.settings.events.onLoadError(t,e)})},captchaRefresh:function(){t("."+this._prefix+"-captcha-img").show(),t("."+this._prefix+"-captcha-img").attr("src",this.settings.captcha+"?"+(new Date).getTime()),t("."+this._prefix+"-captcha-field").val("")},_captchaInit:function(){this.captchaRefresh();var e=this;t("img."+this._prefix+"-captcha-img").click(function(){e.captchaRefresh()})},_template:function(t,e){for(var s in e)t=t.replace(new RegExp("{"+s+"}","g"),e[s]);return t},validate:function(e){var s=this,i={},a={};for(var l in this.settings.items){var r=this.settings.items[l];if(-1!==this._formTypes.indexOf(r.type))if("launcher"!==r.type){if("valueslist"!==r.type||"continue"!==function(){if(e[l])return a[l]=e[l].value,"continue";var i=[];return t("."+s._prefix+"-"+l+"-item").each(function(){i.push({p:String(t(this).find("*>.formBuilder-valueslist-par").val()),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),a[l]=i,"continue"}())if("checkboxlist"!==r.type){var n=e?e[l]?e[l].value:void 0:t("#"+this._prefix+"_"+l).val();if(r.validation){if(!r.validation.mandatoryEdit&&!n&&this.settings.edit||!r.validation.mandatoryCreate&&!n&&!this.settings.edit)continue;if(r.validation.mandatoryCreate&&!n&&!this.settings.edit){i[l]=this.settings.lang.mandatoryMissing;continue}if(r.validation.mandatoryEdit&&!n&&this.settings.edit){i[l]=this.settings.lang.mandatoryMissing;continue}if(r.validation.process&&"function"==typeof r.validation.process&&(n=r.validation.process(n)),"passwordConfirm"===r.type&&t("#"+this._prefix+"_"+l+"Confirm").val()!==n){i[l]=this.settings.lang.passwordsNotMatch;continue}if(r.validation.length){if(r.validation.length.min&&n.length<r.validation.length.min){i[l]=this.settings.lang.tooShort;continue}if(r.validation.length.max&&n.length>r.validation.length.max){i[l]=this.settings.lang.tooLong;continue}}if(r.validation.regexp&&!n.match(r.validation.regexp)){i[l]=this.settings.lang.invalidFormat;continue}a[l]=n}}else{var o=t("."+this._prefix+"-"+l+"-cbx:checked").map(function(){return t(this).attr("data")}).get();a[l]=e?e[l]?e[l].value:void 0:o.join(",")}}else a[l]=e?e[l]?e[l].id:void 0:t("#"+this._prefix+"_"+l+"_val").attr("data")}return{data:a,errors:i}},errors:function(e){if(Object.keys(e).length>0){var s=!1;for(var i in e)t("#"+this._prefix+"_"+i).addClass(this.settings.formDangerClass),t("#"+this._prefix+"_"+i+"_error_text > span").html(e[i]),t("#"+this._prefix+"_"+i+"_error_text").show(),s||(t("#"+this._prefix+"_"+i).focus(),s=!0),"passwordConfirm"===this.settings.items[i].type&&t("#"+this._prefix+"_"+i+"Confirm").addClass(this.settings.formDangerClass);return!0}return!1},_submit:function(){if(!this._saving){this.settings.events.onSaveSubmit&&this.settings.events.onSaveSubmit(),this.clearErrors();var e=this,s={},i={};if(this.settings.validation){var a=this.validate();if(s=a.data||{},i=a.errors||{},this.errors(i))return;if(this.settings.events.onSaveValidate&&"__stop"===(s=this.settings.events.onSaveValidate(s)||s))return}else if(this.settings.events.onSaveValidate&&"__stop"===(s=this.settings.events.onSaveValidate(s)))return;e._saving=!0,t.ajax({type:this.settings.save.method,url:this.settings.save.url,data:s,cache:!1}).done(function(s){if(e._saving=!1,s&&1===s.status)e.settings.events.onSaveSuccess&&e.settings.events.onSaveSuccess(s);else{if(s.fields)for(var i in s.fields){var a=!1;t("#"+e._prefix+"_"+s.fields[i]).addClass(e.settings.formDangerClass),a||(t("#"+e._prefix+"_"+s.fields[i]).focus(),a=!0)}e.captchaRefresh(),e.settings.events.onSaveError&&e.settings.events.onSaveError(s)}}).fail(function(t,s){e._saving=!1,e.captchaRefresh(),e.settings.events.onSaveError&&e.settings.events.onSaveError(t,s)})}}}),t.fn.zoiaFormBuilder=function(e){var i=void 0;return this.each(function(){(i=t.data(this,"plugin_zoiaFormBuilder"))||(i=new s(this,e),t.data(this,"plugin_zoiaFormBuilder",i))}),i}}(jQuery,window,document),$(document).ready(function(){$("#zoiaResetConfirm").zoiaFormBuilder({save:{url:"/api/auth/reset/confirm",method:"POST"},formDangerClass:"za-form-danger",template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:lang["Should not be empty"],tooShort:lang["Too short"],tooLong:lang["Too long"],invalidFormat:lang["Doesn't match required format"],passwordsNotMatch:lang["Passwords do not match"]},html:{helpText:'<div class="za-text-meta">{text}</div>',text:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><input class="za-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>',select:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><select class="za-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-flex"><div class="{prefix}-field-wrap"><input class="za-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="za-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',captcha:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-grid za-grid-small"><div><input class="za-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="za-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="za-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}_btn">{label}:</label><div class="za-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="za-button za-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}</div>',textarea:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><textarea class="za-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>'},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(t){return $("#zoiaResetConfirmSpinner").show(),$("#zoiaResetConfirm_btnSave").toggleClass("za-button-primary").toggleClass("za-button-default"),t.username=usernameConfirm,t.code=codeConfirm,t},onSaveSuccess:function(){$("#zoiaResetConfirm").hide(),$("#resetConfirmSuccessful").show(),$("html, body").animate({scrollTop:$("#zoiaResetConfirm").offset().top-20},"fast")},onSaveError:function(){$("#zoiaResetConfirmSpinner").hide(),$("#zoiaResetConfirm_btnSave").toggleClass("za-button-primary").toggleClass("za-button-default"),$("#zoiaResetConfirm_password").focus(),$zUI.notification(lang["Error while setting new password"],{status:"danger"})}},items:{password:{autofocus:!0,type:"passwordConfirm",label:lang.Password,helpText:lang["Minimal length: 5 characters, type twice to verify"],validation:{mandatoryCreate:!0,length:{min:5,max:50},process:function(t){return t.trim()}}},buttons:{type:"buttons",css:"za-margin-top",buttons:[{name:"btnSave",label:'<div za-spinner class="za-margin-right" id="zoiaResetConfirmSpinner" style="display:none"></div>'+lang.Set,css:"za-button-primary",type:"submit"}]}}})});