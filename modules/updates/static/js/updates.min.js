"use strict";var flagCheckUpdates=!1,updateDialog=void 0,updateProgressDialog=void 0,restartProgressDialog=void 0,btnCheckUpdatesHandler=function(){flagCheckUpdates||($("#spnCheckUpdates").show(),flagCheckUpdates=!0,$.ajax({type:"GET",url:"/api/updates/check",cache:!1}).done(function(e){if($("#spnCheckUpdates").hide(),flagCheckUpdates=!1,e&&1===e.status)if(e.update&&e.update.version){if($("#zoiaUpdateDialogVersion").html(e.update.version),e.update.changelog){var t="";for(var a in e.update.changelog)t+="<li>"+e.update.changelog[a]+"</li>";$("#zoiaUpdateDialogChangelog").html(t)}updateDialog.show()}else $zUI.notification(lang["Your system is up to date"],{status:"success",timeout:1500});else $zUI.notification(lang["Could not get version information from remote server"],{status:"danger",timeout:1500})}).fail(function(){$("#spnCheckUpdates").hide(),flagCheckUpdates=!1,$zUI.notification(lang["Could not get version information from remote server"],{status:"danger",timeout:1500})}))},updateRestart=function(){$.ajax({type:"GET",url:"/api/updates/restart",cache:!1})},updateExtract=function(){$.ajax({type:"GET",url:"/api/updates/extract",cache:!1}).done(function(e){e&&1===e.status?(window.progressbar&&(progressbar.value=100),setTimeout(function(){restartProgressDialog.show(),updateRestart(),setTimeout(function(){restartProgressDialog.hide(),location.href="/admin?rnd="+Date.now()},3e4)},1e3)):(updateProgressDialog.hide(),$zUI.notification(lang["Could not extract the update archive"]+(e.error?": "+e.error:""),{status:"danger",timeout:3e3}))}).fail(function(){updateProgressDialog.hide(),$zUI.notification(lang["Error while updating your system"],{status:"danger",timeout:1500})})},updateDownload=function(){$.ajax({type:"GET",url:"/api/updates/download",cache:!1}).done(function(e){if(!e||1!==e.status)return updateProgressDialog.hide(),void $zUI.notification(lang["Could not download new version from remote server"]+(e.error?": "+e.error:""),{status:"danger",timeout:3e3});window.progressbar&&(progressbar.value=50),updateExtract()}).fail(function(){updateProgressDialog.hide(),$zUI.notification(lang["Error while updating your system"],{status:"danger",timeout:1500})})},btnUpdateStartHandler=function(){updateDialog.hide(),window.progressbar&&(progressbar.value=10),updateProgressDialog.show().then(function(){updateDownload()})};$(document).ready(function(){$("#btnCheckUpdates").click(btnCheckUpdatesHandler),$("#btnUpdateStart").click(btnUpdateStartHandler),updateDialog=$zUI.modal("#zoiaUpdateDialog",{bgClose:!1,escClose:!1}),updateProgressDialog=$zUI.modal("#zoiaUpdateProgressDialog",{bgClose:!1,escClose:!1}),restartProgressDialog=$zUI.modal("#zoiaRestartProgressDialog",{bgClose:!1,escClose:!1})});